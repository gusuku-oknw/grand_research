# 秘密画像共有における pHash 検索を可能にする知覚暗号化の設計

---

## 概要（Abstract）

平文の画像特徴量をサーバに保持する従来の類似画像検索（Content-Based Image Retrieval; CBIR）は情報漏えいのリスクがある。そこで本研究は，秘密画像共有（Secret Image Sharing; SIS）によりシェア数 $r$ に応じて $k_1$ で検索のみ，$k_2$ で復元を許可する二段閾値の知覚暗号化方式を提案する。$k_1$ では検索に必要な低周波符号が一致する知覚ハッシュ（perceptual hash; pHash）整合ダミーを返し，原画像の内容推定に資する視覚情報を開示しない中間状態を定義する。評価では同一IDの派生群を正解集合とした Recall@k を主指標とし，オリジナルのみの1対1照合では Top-1 accuracy が 100\%（plain/dummy 一致），全20バリアント平均で Recall@10=42.41\%、Recall@5=21.65\%（plain/dummy 一致）を得た。検索時間は 0.50/0.49 ms（オリジナル平文/ダミー），0.53/0.49 ms（全バリアント平文/ダミー）で同等であり，復元コストは $k_1$=121 ms，$k_2$=10.2 s に段階化できた。残る課題はアクセスパターン漏えいと pHash の頑健性である。

---

## 第1章 はじめに

### 1.1 研究背景

医療画像，監視カメラ映像，クラウド写真管理サービスなどでは，画像の内容そのものを第三者に開示することなく，類似する画像を検索・照合したいという要求が強く存在する。例えば医療分野では，患者データの秘匿性を保ったまま過去症例と類似する画像を検索することが求められる。一方で従来の類似画像検索（CBIR: Content-Based Image Retrieval）では，検索サーバが画像あるいは画像特徴量を平文で保持し，距離計算により類似度を算出する構成が一般的である。この構成では，サーバ管理者や侵入者により画像情報が漏えいするリスクが避けられない。

### 1.2 研究目的

本研究の目的は，秘密画像共有（Secret Image Sharing; SIS）を基盤として画像を分散保持しつつ，pHash に基づく類似画像検索を可能とする知覚暗号化方式を設計することである。特に，シェア数に応じて復元される情報内容を段階的に制御し，「検索は可能だが閲覧は不可能」という中間的な情報開示レベルを実現することを目指す。

### 1.3 本研究の貢献

本研究の主な貢献は以下の通りである。

1. pHash の低周波符号構造に着目した知覚暗号化方式を設計し，原画像の内容推定に資する視覚情報を秘匿したまま類似検索を可能とした。
2. マルチシークレット型 SIS を用い，シェア数に応じて三段階の情報開示を制御する枠組みを提案した。
3. 評価実験により，検索精度・計算コスト・プライバシ保護のトレードオフを定量的に示した。

### 1.4 本論文の構成

本論文は以下の構成からなる。第2章では関連技術および先行研究を整理する。第3章では提案手法の詳細を述べ，第4章で実装について説明する。第5章では評価実験と結果を示し，第6章で考察を行う。最後に第7章で本研究を総括し，今後の課題を述べる。

---

## 第2章 背景と関連研究

### 2.1 類似画像検索と pHash

pHash（Perceptual Hash）は，画像を低次元のビット列に変換し，知覚的な類似性をハミング距離として比較する手法である。一般に，画像を 32×32 に縮小し，離散コサイン変換（DCT）を適用した後，低周波成分の符号を用いて 64bit のハッシュを生成する。pHash は JPEG 圧縮や軽度のノイズに対してロバストである一方，大きな回転や切り抜きには弱いという特性を持つ。

### 2.2 秘密画像共有（SIS）

秘密画像共有は，Shamir の秘密分散法を基礎とし，画像を複数のシェアに分割して分散保持する手法である。k-of-n の閾値方式により，k 未満のシェアからは情報が得られず，k 以上で原画像を復元できる。従来の SIS は完全復元を目的としており，復元前の中間的な情報開示は想定されていなかった。

### 2.3 プライバシ保護類似画像検索の先行研究

プライバシ保護を目的とした類似画像検索では，秘密分散と安全計算，準同型暗号，Searchable Encryption などが提案されている。多くの研究は CNN 特徴量を用いた高精度検索を対象としているが，計算コストが高く，また pHash のような軽量な知覚ハッシュを対象とした研究は少ない。さらに，シェア数に応じて情報内容を段階的に制御する構成はほとんど見られない。

### 2.4 本研究の位置付け

本研究は，pHash と SIS を組み合わせ，検索に必要な最小限の情報のみを段階的に開示する点に新規性がある。従来研究とは異なり，pHash 整合ダミーという中間レベルの復元を導入することで，検索可能性と秘匿性の両立を図る。

---

## 第3章 提案手法

### 3.1 システムモデルと脅威モデル

本研究では，画像所有者および検索利用者をクライアント，シェアを保持する複数のサーバを想定する。サーバは honest-but-curious とし，単独では画像内容や pHash を推測できないことを前提とする。

### 3.2 三段階情報開示モデル

提案手法では，収集されたシェア数 r に応じて以下の三段階の復元を行う。

* r < k1：完全ノイズ画像（情報ゼロ）
* k1 ≤ r < k2：pHash 整合ダミー画像
* r ≥ k2：原画像の完全復元

### 3.3 pHash 整合ダミー画像の生成

pHash が低周波 DCT 係数の符号に依存する点に着目し，低周波符号のみを目標値に拘束したダミー画像を生成する。具体的には，元画像から target bits を抽出し，それに一致する符号を持つ低周波成分を強調した上で，高周波成分をランダム化し逆 DCT を行う。これにより，視覚的にはノイズであるが pHash は一致する画像が得られる。

### 3.4 登録・検索フロー

登録時には原画像と pHash 整合ダミー画像の双方を SIS により分割し，サーバへ配布する。検索時にはクエリ画像に対して同様の処理を行い，k1 復元により候補削減を行った後，必要に応じて k2 復元を行う。

---

## 第4章 実装

### 4.1 実装環境

本研究では Python を用いて実装を行い，NumPy，Pillow 等のライブラリを使用した。

### 4.2 SIS および pHash 実装

Shamir 型秘密分散を整数演算で実装し，マルチシークレット構成に対応させた。pHash は標準的な DCT ベースの手法を用いた。

---

## 第5章 評価実験

### 5.1 実験設定

COCO データセットの一部を用い，JPEG 圧縮，ノイズ付加，回転などの変換を加えた派生画像をクエリとして評価を行った。指標として Recall@k と処理時間を測定した。

### 5.2 検索再現率

pHash 整合ダミー画像を用いた検索において，平文 pHash と同等の候補削減が可能であることを確認した。オリジナルのみの1対1照合では Top-1 accuracy が 100\%となり，全20バリアントでは同一IDの派生群を正解集合とした Recall@10=42.41\%、Recall@5=21.65\% が平文／ダミーで一致した。

### 5.3 処理時間

k1 復元は平均 121 ms，k2 復元は平均 10.2 s であり，二段階構成による計算量削減効果が確認された。

---

## 第6章 考察

提案手法は，検索に必要な最小限の情報のみを開示することでプライバシを保護できる。一方で，攻撃者が得る情報（ダミー画像，pHash，シェア，アクセスパターン）と攻撃目標（カテゴリ推定，人物/文字の有無推定，メンバーシップ推定，復元）を明確にしたうえで，分類精度や復元攻撃成功率などの漏えい評価が必要である。pHash 自体の限界やアクセスパターン漏洩などの課題は残るが，これらは今後，多人数安全計算（MPC）や Trusted Execution Environment（TEE）との統合により改善可能である。

---

## 第7章 おわりに

本研究では，秘密画像共有に基づく pHash 整合型知覚暗号化方式を提案し，段階的な情報開示により類似画像検索とプライバシ保護を両立できることを示した。本手法は，Searchable Encryption を画像知覚特徴に適用する新しい枠組みであり，今後の実運用に向けた基盤技術となることが期待される。

---

## 参考文献

（省略）
